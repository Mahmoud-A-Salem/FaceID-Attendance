@using NewFaceIDAttendance.ViewModels
@model AssignCourseToStudentVM
@{
    Layout = "_AdminLayout";
    var enrolledCourses = ViewBag.EnrolledCourses as IEnumerable<dynamic>;
    var availableCourses = ViewBag.AvailableCourses as IEnumerable<dynamic>;
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Enroll Courses for @Model.StudentName</h2>
        <a asp-action="Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Students
        </a>
    </div>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["Warning"] != null)
    {
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            @TempData["Warning"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Currently Enrolled Courses Section -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">
                <i class="bi bi-check-circle"></i> Currently Enrolled Courses
            </h5>
        </div>
        <div class="card-body">
            @if (enrolledCourses != null && enrolledCourses.Any())
            {
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Course Code</th>
                                <th>Course Name</th>
                                <th>Doctor</th>
                                <th>Year Level</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var course in enrolledCourses)
                            {
                                <tr>
                                    <td><span class="badge bg-primary">@course.CourseCode</span></td>
                                    <td>@course.CourseName</td>
                                    <td>@course.DoctorName</td>
                                    <td>
                                        @if (course.YearLevel != null)
                                        {
                                            <span class="badge bg-info">Year @course.YearLevel</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">N/A</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info mb-0">
                    <i class="bi bi-info-circle"></i> This student is not currently enrolled in any courses.
                </div>
            }
        </div>
    </div>

    <!-- Available Courses Section -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">
                <i class="bi bi-plus-circle"></i> Available Courses to Enroll
            </h5>
        </div>
        <div class="card-body">
            @if (availableCourses != null && availableCourses.Any())
            {
                <form method="post" asp-action="AssignCourses">
                    @Html.HiddenFor(m => m.StudentID)
                    
                    <div class="alert alert-info">
                        <i class="bi bi-lightbulb"></i> 
                        <strong>Instructions:</strong> Select the courses you want to enroll this student in, then click "Enroll Selected Courses" below.
                    </div>

                    <div class="mb-3">
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAll()">
                            <i class="bi bi-check-square"></i> Select All
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="deselectAll()">
                            <i class="bi bi-square"></i> Deselect All
                        </button>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 50px;">
                                        <input type="checkbox" id="selectAllCheckbox" onclick="toggleAll(this)" class="form-check-input">
                                    </th>
                                    <th>Course Code</th>
                                    <th>Course Name</th>
                                    <th>Doctor</th>
                                    <th>Year Level</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var course in availableCourses)
                                {
                                    <tr>
                                        <td>
                                            <input type="checkbox" 
                                                   name="SelectedCourses" 
                                                   value="@course.CourseId" 
                                                   class="form-check-input course-checkbox"
                                                   id="course_@course.CourseId">
                                        </td>
                                        <td>
                                            <label for="course_@course.CourseId" class="mb-0">
                                                <span class="badge bg-primary">@course.CourseCode</span>
                                            </label>
                                        </td>
                                        <td>
                                            <label for="course_@course.CourseId" class="mb-0">
                                                @course.CourseName
                                            </label>
                                        </td>
                                        <td>@course.DoctorName</td>
                                        <td>
                                            @if (course.YearLevel != null)
                                            {
                                                <span class="badge bg-info">Year @course.YearLevel</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">N/A</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <div class="d-flex justify-content-end gap-2 mt-4">
                        <a asp-action="Index" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-check-circle"></i> Enroll Selected Courses
                        </button>
                    </div>
                </form>
            }
            else
            {
                <div class="alert alert-warning mb-0">
                    <i class="bi bi-exclamation-triangle"></i> 
                    <strong>No available courses!</strong> This student is already enrolled in all courses, or there are no courses in the system.
                </div>
                <div class="mt-3">
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Back to Students
                    </a>
                </div>
            }
        </div>
    </div>
</div>

<script>
    function toggleAll(checkbox) {
        const checkboxes = document.querySelectorAll('.course-checkbox');
        checkboxes.forEach(cb => cb.checked = checkbox.checked);
    }

    function selectAll() {
        const checkboxes = document.querySelectorAll('.course-checkbox');
        checkboxes.forEach(cb => cb.checked = true);
        document.getElementById('selectAllCheckbox').checked = true;
    }

    function deselectAll() {
        const checkboxes = document.querySelectorAll('.course-checkbox');
        checkboxes.forEach(cb => cb.checked = false);
        document.getElementById('selectAllCheckbox').checked = false;
    }

    // Update "select all" checkbox state when individual checkboxes change
    document.addEventListener('DOMContentLoaded', function() {
        const courseCheckboxes = document.querySelectorAll('.course-checkbox');
        const selectAllCheckbox = document.getElementById('selectAllCheckbox');
        
        courseCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const allChecked = Array.from(courseCheckboxes).every(cb => cb.checked);
                const noneChecked = Array.from(courseCheckboxes).every(cb => !cb.checked);
                
                if (allChecked) {
                    selectAllCheckbox.checked = true;
                    selectAllCheckbox.indeterminate = false;
                } else if (noneChecked) {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                } else {
                    selectAllCheckbox.indeterminate = true;
                }
            });
        });
    });
</script>

<style>
    .table tbody tr:hover {
        cursor: pointer;
    }
    
    .table tbody td label {
        cursor: pointer;
    }
    
    .card-header h5 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
</style>
